<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hermes Help</title>
    <style>
      /* Rose Pine Color Scheme */
      :root {
        --col-base: #faf4ed;
        --col-surface: #fffaf3;
        --col-overlay: #f2e9e1;
        --col-muted: #9893a5;
        --col-subtle: #797593;
        --col-text: #575279;
        --col-love: #b4637a;
        --col-gold: #ea9d34;
        --col-rose: #d7827e;
        --col-pine: #286983;
        --col-foam: #56949f;
        --col-iris: #907aa9;
        --col-highlightLow: #f4ede8;
        --col-highlightMed: #dfdad9;
        --col-highlightHigh: #cecacd;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --col-base: #191724;
          --col-surface: #1f1d2e;
          --col-overlay: #26233a;
          --col-muted: #6e6a86;
          --col-subtle: #908caa;
          --col-text: #e0def4;
          --col-love: #eb6f92;
          --col-gold: #f6c177;
          --col-rose: #ebbcba;
          --col-pine: #31748f;
          --col-foam: #9ccfd8;
          --col-iris: #c4a7e7;
          --col-highlightLow: #21202e;
          --col-highlightMed: #403d52;
          --col-highlightHigh: #524f67;
        }
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        scroll-behavior: smooth;
        overflow-x: hidden;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background-color: var(--col-base);
        color: var(--col-text);
        line-height: 1.6;
        display: flex;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Sidebar Navigation */
      nav {
        position: fixed;
        left: 0;
        top: 0;
        width: 260px;
        height: 100vh;
        background-color: var(--col-surface);
        border-right: 1px solid var(--col-highlightMed);
        padding: 24px 16px;
        overflow-y: auto;
      }

      nav h1 {
        font-size: 1.25rem;
        color: var(--col-pine);
        margin-bottom: 8px;
        font-weight: 600;
      }

      nav .subtitle {
        font-size: 0.75rem;
        color: var(--col-muted);
        margin-bottom: 24px;
      }

      nav ul {
        list-style: none;
      }

      nav > ul > li {
        margin-bottom: 4px;
      }

      nav a {
        display: block;
        padding: 8px 12px;
        color: var(--col-subtle);
        text-decoration: none;
        border-radius: 6px;
        font-size: 0.875rem;
        transition:
          background-color 0.15s,
          color 0.15s;
      }

      nav a:hover {
        background-color: var(--col-highlightLow);
        color: var(--col-text);
      }

      nav a.active {
        background-color: var(--col-highlightMed);
        color: var(--col-pine);
        font-weight: 500;
      }

      nav ul ul {
        margin-left: 12px;
        margin-top: 4px;
      }

      nav ul ul a {
        font-size: 0.8125rem;
        padding: 6px 12px;
        color: var(--col-muted);
      }

      /* Main Content */
      main {
        margin-left: 260px;
        flex: 1;
        padding: 32px 24px;
        min-width: 0; /* Allow flex item to shrink below content size */
        overflow-x: hidden;
      }

      section {
        margin-bottom: 64px;
      }

      h2 {
        font-size: 1.75rem;
        color: var(--col-pine);
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--col-highlightMed);
      }

      h3 {
        font-size: 1.25rem;
        color: var(--col-text);
        margin-top: 32px;
        margin-bottom: 12px;
      }

      h4 {
        font-size: 1rem;
        color: var(--col-subtle);
        margin-top: 24px;
        margin-bottom: 8px;
      }

      p {
        margin-bottom: 16px;
      }

      ul,
      ol {
        margin-bottom: 16px;
        padding-left: 24px;
      }

      li {
        margin-bottom: 8px;
      }

      code {
        font-family:
          ui-monospace, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono",
          "Roboto Mono", monospace;
        background-color: var(--col-overlay);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.875em;
        overflow-wrap: break-word;
        word-break: break-word;
      }

      pre {
        font-family:
          ui-monospace, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono",
          "Roboto Mono", monospace;
        background-color: var(--col-overlay);
        padding: 16px;
        border-radius: 8px;
        overflow-x: auto;
        margin-bottom: 16px;
        font-size: 0.875rem;
        line-height: 1.5;
        border: 1px solid var(--col-highlightMed);
        max-width: 100%;
      }

      /* HL7 syntax highlighting in pre blocks */
      pre .seg {
        color: var(--col-foam);
        font-weight: 600;
      }

      pre .sep {
        color: var(--col-muted);
      }

      pre .field {
        color: var(--col-text);
      }

      pre .comment {
        color: var(--col-muted);
        font-style: italic;
      }

      /* Tables */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 16px;
        font-size: 0.875rem;
        display: block;
        overflow-x: auto;
      }

      th,
      td {
        padding: 8px 10px;
        text-align: left;
        border: 1px solid var(--col-highlightMed);
      }

      th {
        background-color: var(--col-overlay);
        font-weight: 600;
        color: var(--col-text);
      }

      tr:nth-child(even) {
        background-color: var(--col-highlightLow);
      }

      /* Keyboard shortcuts */
      kbd {
        display: inline-block;
        padding: 4px 8px;
        font-family: ui-monospace, Menlo, Monaco, monospace;
        font-size: 0.75rem;
        background-color: var(--col-overlay);
        border: 1px solid var(--col-highlightHigh);
        border-radius: 4px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Info boxes */
      .note {
        background-color: var(--col-highlightLow);
        border-left: 4px solid var(--col-pine);
        padding: 16px;
        margin-bottom: 16px;
        border-radius: 0 8px 8px 0;
      }

      .tip {
        background-color: var(--col-highlightLow);
        border-left: 4px solid var(--col-gold);
        padding: 16px;
        margin-bottom: 16px;
        border-radius: 0 8px 8px 0;
      }

      .warning {
        background-color: var(--col-highlightLow);
        border-left: 4px solid var(--col-love);
        padding: 16px;
        margin-bottom: 16px;
        border-radius: 0 8px 8px 0;
      }

      .note strong,
      .tip strong,
      .warning strong {
        display: block;
        margin-bottom: 4px;
      }

      /* Links */
      a {
        color: var(--col-pine);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      /* Definition lists for field descriptions */
      dl {
        margin-bottom: 16px;
      }

      dt {
        font-weight: 600;
        color: var(--col-foam);
        margin-top: 12px;
      }

      dd {
        margin-left: 16px;
        color: var(--col-subtle);
      }

      /* Interface tour figure */
      .interface-diagram {
        background-color: var(--col-overlay);
        border: 1px solid var(--col-highlightMed);
        border-radius: 8px;
        padding: 16px;
        margin: 0 0 16px;
        font-family: ui-monospace, monospace;
        font-size: 0.7rem;
        line-height: 1.4;
        white-space: pre;
        overflow-x: auto;
        max-width: 100%;
      }

      .interface-diagram .label {
        color: var(--col-pine);
        font-weight: 600;
      }

      /* Responsive */
      @media (max-width: 900px) {
        nav {
          width: 200px;
        }
        main {
          margin-left: 200px;
          padding: 24px 16px;
        }
      }

      @media (max-width: 700px) {
        nav {
          position: static;
          width: 100%;
          height: auto;
          border-right: none;
          border-bottom: 1px solid var(--col-highlightMed);
        }
        body {
          flex-direction: column;
        }
        main {
          margin-left: 0;
          padding: 24px 16px;
        }
      }

      /* Find bar */
      .find-bar {
        position: fixed;
        top: 0;
        right: 0;
        background: var(--col-surface);
        border: 1px solid var(--col-highlightMed);
        border-top: none;
        border-right: none;
        border-radius: 0 0 0 8px;
        padding: 8px 12px;
        display: none;
        align-items: center;
        gap: 8px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .find-bar.visible {
        display: flex;
      }

      .find-bar input {
        background: var(--col-base);
        border: 1px solid var(--col-highlightMed);
        color: var(--col-text);
        padding: 4px 8px;
        border-radius: 4px;
        width: 200px;
        font-size: 0.875rem;
      }

      .find-bar input:focus {
        outline: none;
        border-color: var(--col-pine);
      }

      .find-bar button {
        background: transparent;
        border: none;
        color: var(--col-subtle);
        cursor: pointer;
        padding: 4px 6px;
        border-radius: 4px;
        font-size: 1rem;
        line-height: 1;
      }

      .find-bar button:hover {
        color: var(--col-text);
        background: var(--col-highlightLow);
      }

      .find-bar .match-count {
        color: var(--col-muted);
        font-size: 0.8125rem;
        min-width: 70px;
        text-align: center;
      }

      mark.find-highlight {
        background: var(--col-gold);
        color: var(--col-base);
        border-radius: 2px;
        padding: 0 2px;
      }

      mark.find-highlight.current {
        background: var(--col-love);
      }
    </style>
  </head>
  <body>
    <!-- Find bar (Cmd/Ctrl+F) -->
    <div class="find-bar" id="find-bar">
      <input type="text" id="find-input" placeholder="Search..." />
      <button id="find-prev" title="Previous (Shift+Enter)">↑</button>
      <button id="find-next" title="Next (Enter)">↓</button>
      <span class="match-count" id="match-count"></span>
      <button id="find-close" title="Close (Escape)">×</button>
    </div>

    <nav>
      <h1>Hermes Help</h1>
      <p class="subtitle">HL7 Message Editor</p>
      <ul>
        <li><a href="#getting-started">Getting Started</a></li>
        <li>
          <a href="#hl7-fundamentals">HL7 Fundamentals</a>
          <ul>
            <li><a href="#what-is-hl7">What is HL7?</a></li>
            <li><a href="#message-structure">Message Structure</a></li>
            <li><a href="#delimiters">Delimiters</a></li>
            <li><a href="#common-segments">Common Segments</a></li>
          </ul>
        </li>
        <li>
          <a href="#editing-messages">Editing Messages</a>
          <ul>
            <li><a href="#message-editor">Message Editor</a></li>
            <li><a href="#segment-tabs">Segment Tabs</a></li>
            <li><a href="#adding-segments">Adding Segments</a></li>
            <li><a href="#segment-operations">Segment Operations</a></li>
          </ul>
        </li>
        <li>
          <a href="#tools">Tools</a>
          <ul>
            <li><a href="#find-replace">Find &amp; Replace</a></li>
            <li><a href="#jump-to-field">Jump to Field</a></li>
            <li><a href="#generate-control-id">Generate Control ID</a></li>
            <li><a href="#insert-timestamp">Insert Timestamp</a></li>
            <li><a href="#compare-messages">Compare Messages</a></li>
            <li><a href="#validation">Validation</a></li>
          </ul>
        </li>
        <li>
          <a href="#file-operations">File Operations</a>
          <ul>
            <li><a href="#export-as">Export As</a></li>
          </ul>
        </li>
        <li>
          <a href="#communication">Communication</a>
          <ul>
            <li><a href="#connection-presets">Connection Presets</a></li>
            <li><a href="#send-tab">Send Tab</a></li>
            <li><a href="#listen-tab">Listen Tab</a></li>
          </ul>
        </li>
        <li>
          <a href="#extensions">Extensions</a>
          <ul>
            <li><a href="#what-extensions-do">What Extensions Do</a></li>
            <li><a href="#managing-extensions">Managing Extensions</a></li>
            <li><a href="#extension-toolbar-buttons">Toolbar Buttons</a></li>
            <li><a href="#extension-windows">Extension Windows</a></li>
            <li><a href="#extension-logs">Viewing Logs</a></li>
          </ul>
        </li>
        <li><a href="#keyboard-shortcuts">Keyboard Shortcuts</a></li>
        <li><a href="#message-types">Message Types Reference</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </nav>

    <main>
      <!-- Getting Started -->
      <section id="getting-started">
        <h2>Getting Started</h2>
        <p>
          Hermes is a desktop application for composing, editing, sending, and
          receiving HL7 messages. It's designed for HL7 system development and
          testing, providing a visual interface for working with healthcare
          interoperability messages.
        </p>

        <h3>Interface Overview</h3>
        <p>The application is divided into several key areas:</p>

        <div class="interface-diagram">
          <span class="label">Toolbar</span>
          ┌─────────────────────────────────────────────────────────────────────────────┐
          │ [New] [Open] [Save] [Save As] │ [Undo] [Redo] [Comm] │ [Help] [Settings]    │
          └─────────────────────────────────────────────────────────────────────────────┘

          <span class="label">Segment Tabs</span>
          ┌─────────────────────────────────────────────────────────────────────┐
          │ [ MSH ] [ PID ] [ PV1 ] [ ORC ] [ + ]                               │
          ├─────────────────────────────────────────────────────────────────────┤
          │ ┌─ Header Fields ──────────────────────────────────────────────┐    │
          │ │ Sending Application: [____________] Message Type: [___]      │    │
          │ │ Receiving Application: [__________] Trigger Event: [__]      │    │
          │ └──────────────────────────────────────────────────────────────┘    │
          └─────────────────────────────────────────────────────────────────────┘
          <span class="label">                         ═══ Resize Handle ═══</span>
          <span class="label">Message Editor</span>
          ┌─────────────────────────────────────────────────────────────────────┐
          │ MSH|^~\&amp;|SendingApp|SendingFac|ReceivingApp|ReceivingFac|...        │
          │ PID|||123456^^^MRN||Doe^John^Q||19800115|M|||...                    │
          │ PV1||I|ICU^101^A||||...                                             │
          └─────────────────────────────────────────────────────────────────────┘

          <span class="label">Status Bar</span>
          ┌─────────────────────────────────────────────────────────────────────┐
          │ PID.5.1 - Patient Name → Family Name             ~/messages/adt.hl7 │
          └─────────────────────────────────────────────────────────────────────┘
        </div>

        <dl>
          <dt>Toolbar</dt>
          <dd>
            Quick access to file operations (New, Open, Save), edit operations
            (Undo, Redo), and application settings.
          </dd>

          <dt>Segment Tabs</dt>
          <dd>
            Form-based editing for each HL7 segment. Click a tab to view and
            edit that segment's fields in a structured format.
          </dd>

          <dt>Resize Handle</dt>
          <dd>
            Drag to adjust the space between the segment tabs and the raw
            message editor.
          </dd>

          <dt>Message Editor</dt>
          <dd>
            Raw HL7 text editor with syntax highlighting. Edit messages directly
            with full control over the message structure.
          </dd>

          <dt>Status Bar</dt>
          <dd>
            Shows your current cursor position within the HL7 message (field
            path and description) and the path to the currently open file.
          </dd>
        </dl>

        <h3>Quick Start</h3>
        <ol>
          <li>
            <strong>Create a new message</strong>: Click <strong>New</strong> or
            press <kbd>Cmd</kbd>+<kbd>N</kbd> to start with a blank MSH segment.
          </li>
          <li>
            <strong>Add segments</strong>: Click the <strong>+</strong> button
            to add segments like PID, PV1, or OBR to your message.
          </li>
          <li>
            <strong>Edit fields</strong>: Use the segment tabs for guided
            editing, or type directly in the message editor.
          </li>
          <li>
            <strong>Save your work</strong>: Press <kbd>Cmd</kbd>+<kbd>S</kbd>
            to save, or enable <strong>Auto-Save</strong> in Settings.
          </li>
        </ol>
      </section>

      <!-- HL7 Fundamentals -->
      <section id="hl7-fundamentals">
        <h2>HL7 Fundamentals</h2>

        <h3 id="what-is-hl7">What is HL7?</h3>
        <p>
          HL7 (Health Level Seven) is a set of international standards for
          exchanging clinical and administrative healthcare data between
          software applications. The name "Level Seven" refers to the
          application layer (Layer 7) of the OSI networking model.
        </p>
        <p>
          HL7 v2.x messages are pipe-delimited text messages used to communicate
          events such as patient admissions, lab orders, results, and billing
          information between healthcare systems. Despite newer standards like
          HL7 FHIR, v2.x remains the most widely deployed healthcare interface
          standard in the world.
        </p>

        <h3 id="message-structure">Message Structure</h3>
        <p>An HL7 message is composed of hierarchical elements:</p>

        <h4>Segments</h4>
        <p>
          A message is made up of <strong>segments</strong>, each on its own
          line. Every segment begins with a three-character identifier (like
          MSH, PID, or OBR) followed by field data.
        </p>
        <pre><span class="seg">MSH</span><span class="sep">|</span>^~\&amp;<span class="sep">|</span>SendingApp<span class="sep">|</span>SendingFac<span class="sep">|</span>ReceivingApp<span class="sep">|</span>ReceivingFac<span class="sep">|</span>202401151030<span class="sep">||</span>ADT^A01<span class="sep">|</span>MSG001<span class="sep">|</span>P<span class="sep">|</span>2.5.1
<span class="seg">PID</span><span class="sep">|||</span>123456^^^MRN<span class="sep">||</span>Doe^John^Q<span class="sep">||</span>19800115<span class="sep">|</span>M
<span class="seg">PV1</span><span class="sep">||</span>I<span class="sep">|</span>ICU^101^A</pre>

        <h4>Fields</h4>
        <p>
          Within each segment, data is divided into
          <strong>fields</strong> separated by the pipe character
          (<code>|</code>). Fields are numbered starting from 1 (though MSH is
          special—see below).
        </p>
        <pre><span class="comment">Field:    1      2          3           4              5</span>
<span class="seg">PID</span><span class="sep">|</span><span class="field">SetID</span><span class="sep">|</span><span class="field">PatientID</span><span class="sep">|</span><span class="field">PatientList</span><span class="sep">|</span><span class="field">AltPatientID</span><span class="sep">|</span><span class="field">PatientName</span><span class="sep">|</span>...</pre>

        <h4>Components</h4>
        <p>
          Fields can be further divided into <strong>components</strong> using
          the caret (<code>^</code>). For example, a patient name field contains
          family name, given name, and middle name as separate components:
        </p>
        <pre><span class="comment">Components:  1 (Family)  2 (Given)  3 (Middle)</span>
             Doe<span class="sep">^</span>John<span class="sep">^</span>Q</pre>

        <h4>Subcomponents</h4>
        <p>
          Components can be divided further into
          <strong>subcomponents</strong> using the ampersand
          (<code>&amp;</code>). This is less common but used for complex data
          like coded values with multiple identifiers.
        </p>

        <h4>Repetition</h4>
        <p>
          Some fields allow multiple values, separated by the tilde
          (<code>~</code>). For example, a patient with multiple phone numbers:
        </p>
        <pre>(555)123-4567<span class="sep">~</span>(555)987-6543</pre>

        <h3 id="delimiters">Delimiters</h3>
        <p>
          HL7 uses special characters as delimiters. These are defined in MSH-2
          (the encoding characters field) and typically are:
        </p>
        <table>
          <thead>
            <tr>
              <th>Character</th>
              <th>Name</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>|</code></td>
              <td>Pipe</td>
              <td>Field separator</td>
            </tr>
            <tr>
              <td><code>^</code></td>
              <td>Caret</td>
              <td>Component separator</td>
            </tr>
            <tr>
              <td><code>~</code></td>
              <td>Tilde</td>
              <td>Repetition separator</td>
            </tr>
            <tr>
              <td><code>\</code></td>
              <td>Backslash</td>
              <td>Escape character</td>
            </tr>
            <tr>
              <td><code>&amp;</code></td>
              <td>Ampersand</td>
              <td>Subcomponent separator</td>
            </tr>
          </tbody>
        </table>

        <div class="note">
          <strong>MSH Field Numbering</strong>
          <p>
            The MSH segment is special: the field separator (<code>|</code>)
            itself is MSH-1, and the encoding characters (<code>^~\&amp;</code>)
            are MSH-2. This means what looks like the "third" field is actually
            MSH-3 (Sending Application).
          </p>
        </div>

        <h3 id="common-segments">Common Segments</h3>

        <h4>MSH - Message Header</h4>
        <p>
          Every HL7 message starts with MSH. It identifies the sending and
          receiving applications, the message type, timestamp, and HL7 version.
          This segment is required in all messages.
        </p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>MSH-1</td>
              <td>Field Separator</td>
              <td>Always <code>|</code></td>
            </tr>
            <tr>
              <td>MSH-2</td>
              <td>Encoding Characters</td>
              <td>Usually <code>^~\&amp;</code></td>
            </tr>
            <tr>
              <td>MSH-3</td>
              <td>Sending Application</td>
              <td>Name of the sending system</td>
            </tr>
            <tr>
              <td>MSH-4</td>
              <td>Sending Facility</td>
              <td>Organisation sending the message</td>
            </tr>
            <tr>
              <td>MSH-5</td>
              <td>Receiving Application</td>
              <td>Name of the receiving system</td>
            </tr>
            <tr>
              <td>MSH-6</td>
              <td>Receiving Facility</td>
              <td>Organisation receiving the message</td>
            </tr>
            <tr>
              <td>MSH-7</td>
              <td>Date/Time of Message</td>
              <td>When the message was created</td>
            </tr>
            <tr>
              <td>MSH-9</td>
              <td>Message Type</td>
              <td>Type and trigger event (for example, ADT^A01)</td>
            </tr>
            <tr>
              <td>MSH-10</td>
              <td>Message Control ID</td>
              <td>Unique message identifier</td>
            </tr>
            <tr>
              <td>MSH-11</td>
              <td>Processing ID</td>
              <td>P (Production), T (Training), D (Debug)</td>
            </tr>
            <tr>
              <td>MSH-12</td>
              <td>Version ID</td>
              <td>HL7 version (for example, 2.5.1)</td>
            </tr>
          </tbody>
        </table>

        <h4>PID - Patient Identification</h4>
        <p>
          Contains patient demographic information like name, date of birth,
          sex, and identifiers.
        </p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>PID-3</td>
              <td>Patient Identifier List</td>
              <td>MRN and other patient IDs</td>
            </tr>
            <tr>
              <td>PID-5</td>
              <td>Patient Name</td>
              <td>Family^Given^Middle^Suffix^Prefix</td>
            </tr>
            <tr>
              <td>PID-7</td>
              <td>Date of Birth</td>
              <td>YYYYMMDD format</td>
            </tr>
            <tr>
              <td>PID-8</td>
              <td>Sex</td>
              <td>M, F, O, U, A, N</td>
            </tr>
            <tr>
              <td>PID-11</td>
              <td>Patient Address</td>
              <td>Street^City^State^ZIP^Country</td>
            </tr>
            <tr>
              <td>PID-13</td>
              <td>Phone Number - Home</td>
              <td>Patient's home phone</td>
            </tr>
          </tbody>
        </table>

        <h4>PV1 - Patient Visit</h4>
        <p>Contains information about the patient's visit or encounter.</p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>PV1-2</td>
              <td>Patient Class</td>
              <td>I (Inpatient), O (Outpatient), E (Emergency)</td>
            </tr>
            <tr>
              <td>PV1-3</td>
              <td>Assigned Patient Location</td>
              <td>Unit^Room^Bed</td>
            </tr>
            <tr>
              <td>PV1-7</td>
              <td>Attending Doctor</td>
              <td>Physician responsible for patient</td>
            </tr>
            <tr>
              <td>PV1-19</td>
              <td>Visit Number</td>
              <td>Unique visit/encounter identifier</td>
            </tr>
            <tr>
              <td>PV1-44</td>
              <td>Admit Date/Time</td>
              <td>When patient was admitted</td>
            </tr>
            <tr>
              <td>PV1-45</td>
              <td>Discharge Date/Time</td>
              <td>When patient was discharged</td>
            </tr>
          </tbody>
        </table>

        <h4>ORC - Common Order</h4>
        <p>
          Contains information common to all orders, like order control codes
          and placer/filler numbers.
        </p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ORC-1</td>
              <td>Order Control</td>
              <td>NW (New), CA (Cancel), SC (Status Changed)</td>
            </tr>
            <tr>
              <td>ORC-2</td>
              <td>Placer Order Number</td>
              <td>Order ID from requesting system</td>
            </tr>
            <tr>
              <td>ORC-3</td>
              <td>Filler Order Number</td>
              <td>Order ID from fulfilling system</td>
            </tr>
            <tr>
              <td>ORC-5</td>
              <td>Order Status</td>
              <td>Current status of the order</td>
            </tr>
          </tbody>
        </table>

        <h4>OBR - Observation Request</h4>
        <p>
          Contains information about a specific observation or test being
          ordered or reported.
        </p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>OBR-2</td>
              <td>Placer Order Number</td>
              <td>Links to ORC-2</td>
            </tr>
            <tr>
              <td>OBR-3</td>
              <td>Filler Order Number</td>
              <td>Links to ORC-3</td>
            </tr>
            <tr>
              <td>OBR-4</td>
              <td>Universal Service ID</td>
              <td>What is being ordered (code^description)</td>
            </tr>
            <tr>
              <td>OBR-7</td>
              <td>Observation Date/Time</td>
              <td>When observation was made</td>
            </tr>
          </tbody>
        </table>

        <h4>OBX - Observation Result</h4>
        <p>Contains the actual observation or result data.</p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>OBX-2</td>
              <td>Value Type</td>
              <td>NM (Numeric), ST (String), TX (Text)</td>
            </tr>
            <tr>
              <td>OBX-3</td>
              <td>Observation Identifier</td>
              <td>What was measured (code^description)</td>
            </tr>
            <tr>
              <td>OBX-5</td>
              <td>Observation Value</td>
              <td>The actual result value</td>
            </tr>
            <tr>
              <td>OBX-6</td>
              <td>Units</td>
              <td>Unit of measure</td>
            </tr>
            <tr>
              <td>OBX-11</td>
              <td>Observation Result Status</td>
              <td>F (Final), P (Preliminary), C (Corrected)</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Editing Messages -->
      <section id="editing-messages">
        <h2>Editing Messages</h2>

        <h3 id="message-editor">Message Editor</h3>
        <p>
          The message editor is a text area with HL7-aware features that make
          editing messages easier and less error-prone.
        </p>

        <h4>Syntax Highlighting</h4>
        <p>
          The editor uses colour coding to help you understand message structure
          at a glance:
        </p>
        <ul>
          <li>
            <strong style="color: var(--col-foam)">Segment identifiers</strong>
            (MSH, PID, PV1) are highlighted in teal
          </li>
          <li>
            <strong style="color: var(--col-muted)">Field separators</strong>
            (<code>|</code>) are dimmed to reduce visual noise
          </li>
          <li>
            <strong style="color: var(--col-subtle)"
              >Encoding characters</strong
            >
            (<code>^~\&amp;</code>) are shown in a subtle color
          </li>
          <li>
            <strong style="color: var(--col-iris)">Timestamps</strong> are
            highlighted in purple for easy identification
          </li>
          <li>
            <strong style="color: var(--col-love)">Parse errors</strong> are
            shown in red if the message has structural issues
          </li>
        </ul>

        <h4>Field Navigation</h4>
        <p>
          Press <kbd>Tab</kbd> to jump to the next HL7 field, or
          <kbd>Shift</kbd>+<kbd>Tab</kbd> to jump to the previous field. This is
          much faster than manually navigating with arrow keys.
        </p>

        <h4>Cursor Position Tracking</h4>
        <p>
          As you move through the message, the status bar at the bottom shows
          your current position in HL7 terms. For example:
        </p>
        <pre>PID.5.1 - Patient Name → Family Name</pre>
        <p>
          This tells you that your cursor is in the PID segment, field 5
          (Patient Name), component 1 (Family Name). The description helps you
          understand what data belongs in each position.
        </p>

        <h4>Copy to Clipboard</h4>
        <p>
          Hover over the message editor to reveal a copy button in the corner.
          Click it to copy the entire message to your clipboard. A checkmark
          appears briefly to confirm the copy succeeded.
        </p>

        <h3 id="segment-tabs">Segment Tabs</h3>
        <p>
          Above the message editor, tabs provide a form-based interface for
          editing each segment. This is often easier than editing raw text,
          especially for complex fields.
        </p>

        <h4>Two-Way Sync</h4>
        <p>
          Changes in the segment tabs immediately update the raw message, and
          vice versa. You can freely switch between editing modes without losing
          data.
        </p>

        <h4>Field Grouping</h4>
        <p>
          Related fields are grouped into fieldsets for easier navigation. For
          example, the MSH tab groups sending application and facility together,
          separate from receiving information.
        </p>

        <h4>Tabs Follow Cursor (Optional)</h4>
        <p>
          Enable <strong>Tabs Follow Cursor</strong> in Settings to
          automatically switch tabs as you navigate through the message editor.
          When your cursor enters a PV1 segment, the PV1 tab will automatically
          activate.
        </p>

        <h3 id="adding-segments">Adding Segments</h3>
        <p>
          Click the <strong>+</strong> button next to the segment tabs to add a
          new segment. A dropdown appears showing available segment types based
          on your message type.
        </p>
        <p>
          For example, if you're editing an ADT^A01 message, you'll see options
          to add PID, PV1, EVN, NK1, DG1, and NTE segments.
        </p>

        <div class="tip">
          <strong>Segment Order</strong>
          <p>
            HL7 messages have a defined segment order. When you add a segment,
            it will be inserted at the appropriate position in the message
            according to the HL7 specification.
          </p>
        </div>

        <h4>Repeated Segments</h4>
        <p>
          Some segments can appear multiple times (like OBX for multiple
          results). When you have repeated segments, tabs are numbered: "OBX
          (1)", "OBX (2)", etc.
        </p>

        <h3 id="segment-operations">Segment Operations</h3>
        <p>
          Keyboard shortcuts allow you to manipulate entire segments without
          manual cut/paste operations. These are particularly useful when
          working with repeating segments like OBX or NK1, which often need
          duplication with minor edits, or when reordering segments during
          message construction.
        </p>

        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Operation</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>K</kbd></td>
              <td>Delete Segment</td>
              <td>Removes the segment under the cursor</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>↑</kbd></td>
              <td>Move Segment Up</td>
              <td>Swaps the segment with the one above it</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>↓</kbd></td>
              <td>Move Segment Down</td>
              <td>Swaps the segment with the one below it</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>D</kbd></td>
              <td>Duplicate Segment</td>
              <td>Duplicates the segment directly below its current position</td>
            </tr>
          </tbody>
        </table>

        <p>
          After each operation, the cursor follows the affected segment so you
          can continue editing without repositioning.
        </p>

        <div class="warning">
          <strong>MSH Protection</strong>
          <p>
            The MSH segment cannot be deleted, moved, or duplicated. Every HL7
            message requires exactly one MSH as the first segment—these
            operations would create invalid messages.
          </p>
        </div>

        <p>
          These operations are also available from the
          <strong>Edit</strong> menu if you prefer using the mouse.
        </p>
      </section>

      <!-- Tools -->
      <section id="tools">
        <h2>Tools</h2>
        <p>
          Hermes includes several tools to help you work with HL7 messages more
          efficiently. Access these tools from the <strong>Tools</strong> menu
          or use their keyboard shortcuts.
        </p>
      </section>

      <!-- Find & Replace -->
      <section id="find-replace">
        <h3>Find &amp; Replace</h3>
        <p>
          Use Find &amp; Replace to search for text in your message and
          optionally replace it with different text.
        </p>

        <h4>Opening the Find Bar</h4>
        <ul>
          <li>
            Press <kbd>Cmd</kbd>+<kbd>F</kbd> (Mac) or <kbd>Ctrl</kbd>+<kbd
              >F</kbd
            >
            (Windows/Linux) to open Find.
          </li>
          <li>
            Press <kbd>Cmd</kbd>+<kbd>H</kbd> (Mac) or <kbd>Ctrl</kbd>+<kbd
              >H</kbd
            >
            (Windows/Linux) to open Find &amp; Replace.
          </li>
          <li>
            Or use the <strong>Edit</strong> menu, then select
            <strong>Find</strong> or <strong>Find and Replace</strong>.
          </li>
        </ul>

        <div class="tip">
          <strong>Selection Pre-population</strong>
          <p>
            If you have text selected when opening Find, the search field is
            automatically populated with your selection.
          </p>
        </div>

        <h4>Searching</h4>
        <p>
          Type your search term in the Find field. Matches are highlighted in
          the message editor as you type:
        </p>
        <ul>
          <li>
            <strong
              style="
                background-color: var(--col-gold);
                color: #000;
                padding: 2px 4px;
                border-radius: 2px;
              "
              >Gold</strong
            >
            highlighting shows all matches.
          </li>
          <li>
            <strong
              style="
                background-color: var(--col-iris);
                color: #000;
                padding: 2px 4px;
                border-radius: 2px;
              "
              >Purple</strong
            >
            highlighting shows the current match.
          </li>
        </ul>

        <p>The match counter shows your position (for example, "1 of 5").</p>

        <h4>Navigation</h4>
        <ul>
          <li>
            Click the <strong>Next</strong> button or press <kbd>Enter</kbd> to
            go to the next match.
          </li>
          <li>
            Click the <strong>Previous</strong> button or press
            <kbd>Shift</kbd>+<kbd>Enter</kbd> to go to the previous match.
          </li>
        </ul>

        <h4>Case Sensitivity</h4>
        <p>
          Click the <strong>Aa</strong> button to toggle case-sensitive search.
          When enabled, searching for "DOE" will not match "Doe" or "doe".
        </p>

        <h4>Replacing</h4>
        <ol>
          <li>Enter the replacement text in the Replace field</li>
          <li>Navigate to the match you want to replace</li>
          <li>Click <strong>Replace</strong> to replace the current match</li>
          <li>
            Or click <strong>Replace All</strong> to replace every match at once
          </li>
        </ol>

        <div class="warning">
          <strong>Caution</strong>
          <p>
            Replace All cannot be undone in a single step. Each replacement
            creates a separate undo entry, so you may need to undo multiple
            times to fully revert a Replace All operation.
          </p>
        </div>

        <h4>Closing the Find Bar</h4>
        <p>
          Press <kbd>Escape</kbd> or click the <strong>×</strong> button to
          close the Find bar.
        </p>
      </section>

      <!-- Jump to Field -->
      <section id="jump-to-field">
        <h3>Jump to Field</h3>
        <p>
          Jump to Field lets you navigate directly to any HL7 field by entering
          its path. This is faster than scrolling or searching when you know
          exactly which field you need.
        </p>

        <h4>Opening Jump to Field</h4>
        <ul>
          <li>
            Press <kbd>Cmd</kbd>+<kbd>J</kbd> (Mac) or <kbd>Ctrl</kbd>+<kbd
              >J</kbd
            >
            (Windows/Linux).
          </li>
          <li>
            Or use the <strong>Edit</strong> menu, then select
            <strong>Jump to Field</strong>.
          </li>
        </ul>

        <h4>Field Path Syntax</h4>
        <p>
          Enter the field path using HL7 dot notation. The field will be
          selected in the message editor.
        </p>
        <table>
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>PID.5</code></td>
              <td>Fifth field of the PID segment</td>
            </tr>
            <tr>
              <td><code>PID.5.1</code></td>
              <td>First component of that field (last name)</td>
            </tr>
            <tr>
              <td><code>PID[2].5</code></td>
              <td>Fifth field of the <em>second</em> PID segment</td>
            </tr>
            <tr>
              <td><code>MSH.9.1</code></td>
              <td>Message type (e.g., "ADT")</td>
            </tr>
            <tr>
              <td><code>MSH.9.2</code></td>
              <td>Trigger event (e.g., "A01")</td>
            </tr>
          </tbody>
        </table>

        <div class="tip">
          <strong>Common Fields</strong>
          <p>Here are some frequently used field paths:</p>
          <ul>
            <li><code>PID.3</code> — Patient ID (MRN)</li>
            <li><code>PID.5</code> — Patient Name</li>
            <li><code>PV1.2</code> — Patient Class</li>
            <li><code>PV1.3</code> — Assigned Patient Location</li>
            <li><code>OBR.4</code> — Universal Service Identifier</li>
          </ul>
        </div>

        <h4>Error Handling</h4>
        <p>
          If the field path does not exist in the current message (for example,
          asking for PID.5 when there is no PID segment), an error message is
          displayed and you can correct your input.
        </p>
      </section>

      <!-- Generate Control ID -->
      <section id="generate-control-id">
        <h3>Generate Control ID</h3>
        <p>
          The Generate Control ID tool creates a unique message control ID and
          inserts it into the MSH-10 field. Every HL7 message should have a
          unique control ID to identify it during processing and
          acknowledgments.
        </p>

        <h4>Using Generate Control ID</h4>
        <ul>
          <li>
            Use the <strong>Tools</strong> menu, then select
            <strong>Generate Control ID</strong>.
          </li>
        </ul>

        <h4>What It Does</h4>
        <p>
          The tool generates a 20-character alphanumeric string (letters and
          numbers) and places it in MSH-10 (Message Control ID). After
          generation, the new ID is selected in the editor so you can see
          exactly what was inserted.
        </p>

        <div class="note">
          <strong>When to Use</strong>
          <p>
            Generate a new control ID whenever you create a new message or when
            resending a modified message. Receiving systems use this ID to
            detect duplicates and track acknowledgments.
          </p>
        </div>
      </section>

      <!-- Insert Timestamp -->
      <section id="insert-timestamp">
        <h3>Insert Timestamp</h3>
        <p>
          HL7 uses a specific timestamp format (DTM) for date and time values.
          Hermes provides two ways to insert properly formatted timestamps into
          your message.
        </p>

        <h4>HL7 Timestamp Format</h4>
        <p>
          HL7 timestamps follow the format
          <code>YYYYMMDDHHmmss±ZZZZ</code> where:
        </p>
        <ul>
          <li><code>YYYY</code> — Four-digit year</li>
          <li><code>MM</code> — Two-digit month (01-12)</li>
          <li><code>DD</code> — Two-digit day (01-31)</li>
          <li><code>HH</code> — Two-digit hour in 24-hour format (00-23)</li>
          <li><code>mm</code> — Two-digit minutes (00-59)</li>
          <li><code>ss</code> — Two-digit seconds (00-59)</li>
          <li>
            <code>±ZZZZ</code> — UTC offset (for example, <code>-0500</code> for
            Eastern Time, <code>+0000</code> for UTC)
          </li>
        </ul>
        <p>Example: <code>20250115143000-0500</code> represents January 15, 2025 at 2:30:00 PM Eastern Time.</p>

        <h4>Insert Current Timestamp</h4>
        <p>
          Inserts the current date and time at the cursor position. The
          timestamp includes your system's UTC offset.
        </p>
        <ul>
          <li>
            Place your cursor in the field where you want the timestamp.
          </li>
          <li>
            Use the <strong>Tools</strong> menu, then select
            <strong>Insert Current Timestamp</strong>.
          </li>
          <li>
            The current date/time replaces the field content and is selected in
            the editor.
          </li>
        </ul>

        <h4>Insert Timestamp...</h4>
        <p>
          Opens a dialog where you can specify a particular date, time, and
          timezone.
        </p>
        <ul>
          <li>
            Place your cursor in the field where you want the timestamp.
          </li>
          <li>
            Use the <strong>Tools</strong> menu, then select
            <strong>Insert Timestamp...</strong>
          </li>
          <li>
            In the dialog, select the <strong>Date</strong> and
            <strong>Time</strong> using the pickers.
          </li>
          <li>
            Choose a <strong>UTC Offset</strong> from the dropdown, or leave it
            as "Local timezone" to use your system's offset.
          </li>
          <li>
            Optionally uncheck <strong>Include UTC offset in timestamp</strong>
            to omit the offset portion.
          </li>
          <li>Click <strong>Insert</strong> to insert the timestamp.</li>
        </ul>

        <div class="tip">
          <strong>Omitting the UTC Offset</strong>
          <p>
            If you uncheck the offset option, receiving systems will interpret
            the timestamp using the message header timestamp offset (MSH-7). If
            MSH-7 also lacks an offset, the timestamp is assumed to be in the
            local time of the receiving system.
          </p>
        </div>

        <h4>Menu Availability</h4>
        <p>
          Both timestamp menu items are only enabled when your cursor is
          positioned within a valid HL7 field. If your cursor is on a segment
          name or between segments, the menu items will be disabled.
        </p>
      </section>

      <!-- Compare Messages -->
      <section id="compare-messages">
        <h3>Compare Messages</h3>
        <p>
          The Compare Messages feature provides semantic diffing for HL7
          messages. Unlike text-based diff tools, it understands HL7 structure
          and identifies changes at the segment, field, component, and
          subcomponent levels.
        </p>

        <h4>Opening Compare Messages</h4>
        <ul>
          <li>
            Press <kbd>Cmd</kbd>+<kbd>D</kbd> (Mac) or <kbd>Ctrl</kbd>+<kbd
              >D</kbd
            >
            (Windows/Linux).
          </li>
          <li>
            Or use the <strong>Tools</strong> menu, then select
            <strong>Compare Messages...</strong>
          </li>
        </ul>

        <h4>Loading Messages</h4>
        <p>
          The comparison modal shows two side-by-side panes for the messages you
          want to compare:
        </p>
        <ul>
          <li><strong>Left (Original)</strong>: The baseline message.</li>
          <li>
            <strong>Right (Modified)</strong>: The message to compare against.
          </li>
        </ul>
        <p>Each pane supports two loading methods:</p>
        <ul>
          <li>
            <strong>From Editor</strong>: Loads the current message from the
            main editor.
          </li>
          <li>
            <strong>From File</strong>: Opens a file dialog to select an HL7
            file from disk.
          </li>
        </ul>
        <p>You can also paste messages directly into either pane.</p>

        <h4>Understanding the Diff</h4>
        <p>
          Click <strong>Compare</strong> to analyse the differences. The results
          show three types of changes:
        </p>
        <table>
          <thead>
            <tr>
              <th>Indicator</th>
              <th>Colour</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>+</code></td>
              <td
                style="
                  background-color: #56949f;
                  color: #000;
                  padding: 2px 6px;
                  border-radius: 2px;
                "
              >
                Green
              </td>
              <td>
                Added — element exists only in the right (modified) message
              </td>
            </tr>
            <tr>
              <td><code>-</code></td>
              <td
                style="
                  background-color: #b4637a;
                  color: #fff;
                  padding: 2px 6px;
                  border-radius: 2px;
                "
              >
                Red
              </td>
              <td>
                Removed — element exists only in the left (original) message
              </td>
            </tr>
            <tr>
              <td><code>~</code></td>
              <td
                style="
                  background-color: #ea9d34;
                  color: #000;
                  padding: 2px 6px;
                  border-radius: 2px;
                "
              >
                Gold
              </td>
              <td>
                Modified — element exists in both but with different values
              </td>
            </tr>
          </tbody>
        </table>

        <h4>Inline Highlighting</h4>
        <p>
          Changed values are highlighted directly in both message panes, making
          it easy to see exactly where differences occur. The diff list below
          the messages shows each change with its field path and values.
        </p>

        <h4>Summary Statistics</h4>
        <p>
          The diff results header shows a summary of changes: how many segments
          were added, removed, or modified. This gives you a quick overview
          before drilling into details.
        </p>

        <h4>Why Semantic Diffing?</h4>
        <p>
          Standard text diff tools treat HL7 messages as lines of text, which
          makes their output difficult to interpret. A single field change
          appears as an entire segment being different, and there is no
          indication of which specific fields changed.
        </p>
        <p>Semantic diffing solves this by:</p>
        <ul>
          <li>
            Matching segments by name and occurrence (PID to PID, not by line
            number).
          </li>
          <li>
            Drilling down to identify exactly which field or component changed.
          </li>
          <li>
            Providing field paths (for example, "PID.5.1 changed from 'Smith' to
            'Jones'").
          </li>
        </ul>

        <div class="tip">
          <strong>Use Cases</strong>
          <ul>
            <li>
              <strong>Debugging transformations</strong>: Verify that an
              interface engine modified only the expected fields.
            </li>
            <li>
              <strong>Regression testing</strong>: Compare a message before and
              after a code change.
            </li>
            <li>
              <strong>Learning HL7</strong>: Understand what fields differ
              between message types.
            </li>
            <li>
              <strong>Troubleshooting</strong>: Compare a working message with a
              failing one to spot differences.
            </li>
          </ul>
        </div>
      </section>

      <!-- Validation -->
      <section id="validation">
        <h3>Validation</h3>
        <p>
          The Validation feature checks your HL7 message against schema
          definitions to identify structural errors, missing required fields,
          and values that do not conform to expected formats. Validation issues
          are displayed in a collapsible panel below the editor and highlighted
          inline in the message text.
        </p>

        <h4>Validation Modes</h4>
        <p>Hermes provides two validation modes:</p>

        <table>
          <thead>
            <tr>
              <th>Mode</th>
              <th>When It Runs</th>
              <th>What It Checks</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Light</strong></td>
              <td>Automatically, 500ms after you stop typing</td>
              <td>Parse errors, required fields</td>
            </tr>
            <tr>
              <td><strong>Full</strong></td>
              <td>On demand via menu or keyboard shortcut</td>
              <td>
                All light checks plus: length limits, pattern matching, allowed
                values, required segments, date formats
              </td>
            </tr>
          </tbody>
        </table>

        <h4>Running Full Validation</h4>
        <ul>
          <li>
            Press <kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd> (Mac) or
            <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd> (Windows/Linux).
          </li>
          <li>
            Or use the <strong>Tools</strong> menu, then select
            <strong>Validate Message</strong>.
          </li>
        </ul>

        <h4>Understanding the Validation Panel</h4>
        <p>
          The Validation Panel appears below the message editor when validation
          results are available. Click the panel header to expand or collapse
          it.
        </p>
        <p>The panel header shows a summary of issues found:</p>
        <ul>
          <li>
            <strong
              style="
                background-color: var(--col-love);
                color: #fff;
                padding: 2px 6px;
                border-radius: 3px;
              "
              >Errors</strong
            >
            — Critical issues that likely prevent message processing.
          </li>
          <li>
            <strong
              style="
                background-color: var(--col-gold);
                color: #000;
                padding: 2px 6px;
                border-radius: 3px;
              "
              >Warnings</strong
            >
            — Potential problems that may cause issues with some systems.
          </li>
          <li>
            <strong
              style="
                background-color: var(--col-foam);
                color: #000;
                padding: 2px 6px;
                border-radius: 3px;
              "
              >Info</strong
            >
            — Informational notes about the message.
          </li>
        </ul>

        <h4>Navigating to Issues</h4>
        <p>
          Double-click any issue in the panel to navigate to the problematic
          field in the message editor. The field content will be selected for
          easy editing.
        </p>
        <p>
          Issues without a navigable location (such as missing required
          segments) appear slightly dimmed and cannot be double-clicked.
        </p>

        <h4>Inline Highlighting</h4>
        <p>
          Validation issues are also highlighted directly in the message editor,
          using colour-coded underlines that match the issue severity. This lets
          you see problems in context while editing.
        </p>

        <h4>Types of Issues Detected</h4>
        <table>
          <thead>
            <tr>
              <th>Rule</th>
              <th>Description</th>
              <th>Mode</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Parse Error</td>
              <td>Message structure is invalid or incomplete</td>
              <td>Light</td>
            </tr>
            <tr>
              <td>Required Field</td>
              <td>A required field is missing or empty</td>
              <td>Light</td>
            </tr>
            <tr>
              <td>Required Segment</td>
              <td>A required segment is missing from the message</td>
              <td>Full</td>
            </tr>
            <tr>
              <td>Min Length</td>
              <td>Field value is shorter than the minimum length</td>
              <td>Full</td>
            </tr>
            <tr>
              <td>Max Length</td>
              <td>Field value exceeds the maximum length</td>
              <td>Full</td>
            </tr>
            <tr>
              <td>Pattern</td>
              <td>Field value does not match the expected format</td>
              <td>Full</td>
            </tr>
            <tr>
              <td>Allowed Values</td>
              <td>Field value is not in the list of permitted values</td>
              <td>Full</td>
            </tr>
            <tr>
              <td>Invalid Date</td>
              <td>Date or datetime field has an invalid format</td>
              <td>Full</td>
            </tr>
          </tbody>
        </table>

        <div class="tip">
          <strong>Validation and Message Type</strong>
          <p>
            Validation is context-aware. Required segments and some field rules
            depend on the message type in MSH-9. For example, an ADT^A01 message
            requires PID and PV1 segments, but these might not be required for
            other message types.
          </p>
        </div>

        <div class="note">
          <strong>Schema Coverage</strong>
          <p>
            Validation rules are based on the HL7 segment schemas included with
            Hermes. Not all fields have defined constraints. If a field passes
            validation, it does not guarantee the receiving system will accept
            it—always test with your actual interface partners.
          </p>
        </div>
      </section>

      <!-- File Operations -->
      <section id="file-operations">
        <h2>File Operations</h2>

        <h3>Creating a New Message</h3>
        <p>
          Click <strong>New</strong> in the toolbar or press <kbd>Cmd</kbd>+<kbd
            >N</kbd
          >
          to create a new message. This creates a minimal MSH segment with
          default values that you can customise.
        </p>
        <p>
          If you have unsaved changes, you'll be prompted to save them first.
        </p>

        <h3>Opening Files</h3>
        <p>
          Click <strong>Open</strong> or press <kbd>Cmd</kbd>+<kbd>O</kbd> to
          open an HL7 file. The application opens files with the
          <code>.hl7</code> extension.
        </p>

        <h4>Open Recent</h4>
        <p>
          The <strong>File</strong> menu → <strong>Open Recent</strong> submenu
          shows up to 10 recently opened files for quick access. Click a file to
          open it, or choose <strong>Clear Recent</strong> to clear the list.
        </p>

        <h3>Saving Files</h3>
        <ul>
          <li>
            <strong>Save</strong> (<kbd>Cmd</kbd>+<kbd>S</kbd>): Saves to the
            current file. If the file has not been saved before, this acts like
            Save As.
          </li>
          <li>
            <strong>Save As</strong>
            (<kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd>): Always prompts for a
            filename and location.
          </li>
        </ul>

        <h4>Unsaved Changes Indicator</h4>
        <p>
          When you have unsaved changes, the window title shows a dot (•) and
          the Save button becomes active. After saving, the indicator
          disappears.
        </p>

        <h3>Auto-Save</h3>
        <p>
          Enable Auto-Save to automatically save your changes as you work. When
          enabled, changes are saved 500 milliseconds after you stop typing.
        </p>
        <p>To enable Auto-Save:</p>
        <ul>
          <li>
            Go to <strong>Settings</strong> and toggle
            <strong>Auto-Save</strong>, or
          </li>
          <li>
            Use the <strong>File</strong> menu, then select
            <strong>Auto-Save</strong> (shows a checkmark when enabled).
          </li>
        </ul>

        <div class="note">
          <strong>New Files</strong>
          <p>
            Auto-Save only works for files that have been saved at least once.
            New, unsaved documents will not be auto-saved. You must use Save or
            Save As first.
          </p>
        </div>

        <h3>Undo and Redo</h3>
        <p>
          The application maintains a complete history of your changes, allowing
          you to undo and redo as needed.
        </p>
        <ul>
          <li>
            <strong>Undo</strong> (<kbd>Cmd</kbd>+<kbd>Z</kbd>): Reverts the
            last change
          </li>
          <li>
            <strong>Redo</strong>
            (<kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd>): Reapplies an undone
            change
          </li>
        </ul>

        <h4>How Undo Works</h4>
        <p>The undo system is smart about grouping changes:</p>
        <ul>
          <li>
            <strong>Typing</strong>: Rapid keystrokes (within 500ms) are grouped
            into a single undo entry, so you do not have to undo each character
            individually.
          </li>
          <li>
            <strong>Form edits</strong>: Each change in the segment tabs creates
            a separate undo entry for precise control.
          </li>
        </ul>

        <p>
          The Undo/Redo buttons in the toolbar (and menu items) are disabled
          when there is nothing to undo or redo.
        </p>

        <h3 id="export-as">Export As</h3>
        <p>
          The Export As feature converts your HL7 message to other structured
          formats. This is useful for sharing message data with systems that
          do not understand HL7, for documentation purposes, or for further
          processing with standard data tools.
        </p>

        <h4>Supported Formats</h4>
        <p>
          Use the <strong>File</strong> menu &rarr;
          <strong>Export As</strong> submenu to export your message:
        </p>
        <ul>
          <li>
            <strong>JSON</strong>: JavaScript Object Notation. Widely supported
            and ideal for web APIs and scripting.
          </li>
          <li>
            <strong>YAML</strong>: A human-friendly format often used for
            configuration files. More readable than JSON for complex data.
          </li>
          <li>
            <strong>TOML</strong>: Tom's Obvious Minimal Language. A simple
            configuration format with clear syntax.
          </li>
        </ul>
        <p>
          Each option opens a save dialog where you can choose the destination
          file.
        </p>

        <h4>Output Structure</h4>
        <p>
          The exported data follows a hierarchical structure that mirrors HL7
          organisation:
        </p>
        <ul>
          <li>
            <strong>Segments</strong> become top-level keys. If a segment
            appears multiple times (for example, multiple OBX segments), its
            value becomes an array.
          </li>
          <li>
            <strong>Fields</strong> use 1-based numeric indices as keys. Empty
            fields are omitted to keep the output concise.
          </li>
          <li>
            <strong>Components</strong> also use 1-based numeric indices. Simple
            fields containing only a single value are represented as plain
            strings, while fields with multiple components become nested objects.
          </li>
          <li>
            <strong>Repetitions</strong> (fields with multiple values separated
            by <code>~</code>) become arrays.
          </li>
        </ul>

        <h4>Example</h4>
        <p>Given this HL7 message:</p>
        <pre><span class="seg">MSH</span><span class="sep">|</span>^~\&amp;<span class="sep">|</span>APP<span class="sep">|</span>FAC<span class="sep">|||</span>20231215<span class="sep">||</span>ADT^A01<span class="sep">|</span>123<span class="sep">|</span>P<span class="sep">|</span>2.5.1
<span class="seg">PID</span><span class="sep">|||</span>12345<span class="sep">||</span>DOE^JOHN</pre>
        <p>The JSON export produces:</p>
        <pre>{
  "MSH": {
    "1": "^~\\&amp;",
    "2": "APP",
    "3": "FAC",
    "6": "20231215",
    "8": { "1": "ADT", "2": "A01" },
    "9": "123",
    "10": "P",
    "11": "2.5.1"
  },
  "PID": {
    "3": "12345",
    "5": { "1": "DOE", "2": "JOHN" }
  }
}</pre>

        <div class="tip">
          <strong>Use Cases</strong>
          <ul>
            <li>
              <strong>Documentation</strong>: Include message examples in
              technical specifications or test plans.
            </li>
            <li>
              <strong>Data analysis</strong>: Process message data with tools
              like jq, Python, or spreadsheet applications.
            </li>
            <li>
              <strong>Integration testing</strong>: Compare expected versus
              actual message content using standard diff tools.
            </li>
            <li>
              <strong>Learning</strong>: Visualise HL7 structure in a more
              approachable format.
            </li>
          </ul>
        </div>
      </section>

      <!-- Communication -->
      <section id="communication">
        <h2>Communication</h2>
        <p>
          Hermes can send and receive HL7 messages over the network using MLLP
          (Minimal Lower Layer Protocol), the standard transport mechanism for
          HL7 v2.x messages in healthcare systems. The Communication Drawer
          provides a convenient, non-blocking interface for both sending and
          receiving messages.
        </p>

        <h3 id="connection-presets">Connection Presets</h3>
        <p>
          Connection Presets let you save named host/port combinations for
          environments you frequently connect to, such as Development, QA, and
          Production servers. This eliminates the need to retype connection
          details when switching between systems.
        </p>

        <h4>Using Presets</h4>
        <p>
          In the Send tab, a <strong>Preset</strong> dropdown appears above the
          Host and Port fields. Select a preset to instantly populate the
          connection details.
        </p>
        <ul>
          <li>
            <strong>Custom</strong>: Shown when the current host/port
            combination does not match any saved preset.
          </li>
          <li>
            <strong>Preset names</strong>: Your saved presets appear in the
            dropdown. Selecting one fills in the Host and Port fields.
          </li>
        </ul>
        <p>
          If you manually edit the Host or Port fields, the dropdown
          automatically switches to "Custom" since the values no longer match a
          saved preset.
        </p>

        <h4>Managing Presets</h4>
        <p>
          Click the gear icon next to the Preset dropdown to open the Connection
          Presets modal. From here you can:
        </p>
        <ul>
          <li>
            <strong>Add a preset</strong>: Enter a name, hostname, and port,
            then click <strong>Add</strong>.
          </li>
          <li>
            <strong>Edit a preset</strong>: Click on an existing preset to load
            its values into the form, modify them, then click
            <strong>Update</strong>.
          </li>
          <li>
            <strong>Delete a preset</strong>: Click the trash icon next to a
            preset to remove it.
          </li>
        </ul>
        <p>
          Click <strong>Save</strong> to apply your changes, or
          <strong>Cancel</strong> to discard them. Once saved, presets
          persist across application restarts.
        </p>

        <div class="tip">
          <strong>Naming Conventions</strong>
          <p>
            Use clear, descriptive names for your presets. Common patterns
            include environment names ("Development", "QA", "Production"),
            system names ("Lab Interface", "ADT Server"), or combined names
            ("Prod - Lab Results").
          </p>
        </div>

        <h3>Opening the Communication Drawer</h3>
        <p>
          Click the <strong>Communication</strong> button in the toolbar to open
          the drawer. The button shows the current state:
        </p>
        <ul>
          <li><strong>Grey</strong>: Not listening, drawer closed.</li>
          <li><strong>Green</strong>: Listen server is active.</li>
          <li><strong>Purple</strong>: Drawer is open.</li>
        </ul>
        <p>
          A badge with an unread count appears on the button when there are
          unread received messages.
        </p>

        <h3 id="send-tab">Send Tab</h3>
        <p>
          The Send tab lets you send the current message to a remote MLLP server
          and view the response.
        </p>

        <h4>Configuration</h4>
        <ul>
          <li>
            <strong>Preset</strong>: Select a saved connection preset, or use
            "Custom" to enter values manually. See
            <a href="#connection-presets">Connection Presets</a> for details.
          </li>
          <li>
            <strong>Host</strong>: The server address to send to (IP address or
            hostname).
          </li>
          <li>
            <strong>Port</strong>: The MLLP port number (commonly 2575, but
            varies by system).
          </li>
          <li>
            <strong>Timeout</strong>: How long to wait for a response (in
            seconds).
          </li>
        </ul>
        <p>
          These settings are saved automatically and persist across sessions.
        </p>

        <h4>Sending a Message</h4>
        <ol>
          <li>Configure the host, port, and timeout.</li>
          <li>Click <strong>Send</strong>.</li>
          <li>The status area shows connection progress.</li>
          <li>
            If successful, the response appears in the Response panel with
            syntax highlighting.
          </li>
        </ol>

        <h4>Understanding Responses</h4>
        <p>
          Most receiving systems respond with an ACK (acknowledgment) message.
          Common ACK codes in MSA-1:
        </p>
        <ul>
          <li>
            <strong>AA</strong>: Application Accept - message was processed
            successfully.
          </li>
          <li>
            <strong>AE</strong>: Application Error - message had errors but was
            understood.
          </li>
          <li>
            <strong>AR</strong>: Application Reject - message was rejected.
          </li>
        </ul>

        <h3 id="listen-tab">Listen Tab</h3>
        <p>
          The Listen tab runs an MLLP server to receive incoming HL7 messages
          from other systems.
        </p>

        <h4>Starting the Server</h4>
        <ol>
          <li>Enter the <strong>Port</strong> to listen on (commonly 2575).</li>
          <li>Click <strong>Start Listening</strong>.</li>
          <li>The status shows "Listening on port X" when active.</li>
        </ol>
        <p>Click <strong>Stop Listening</strong> to shut down the server.</p>

        <h4>Viewing Received Messages</h4>
        <p>Received messages appear in the centre list with:</p>
        <ul>
          <li><strong>Filled circle</strong> (●): Unread message.</li>
          <li><strong>Empty circle</strong> (○): Read message.</li>
          <li>
            <strong>Message type</strong>: Extracted from MSH-9 (for example,
            "ADT^A01").
          </li>
          <li><strong>Time</strong>: When the message was received.</li>
        </ul>
        <p>
          Click a message to view it in the right panel with syntax
          highlighting.
        </p>

        <h4>Loading Messages to Editor</h4>
        <p>
          Click <strong>Load to Editor</strong> to copy a received message into
          the main editor. This is useful for modifying and resending messages
          during testing.
        </p>

        <h3>Understanding MLLP</h3>
        <p>
          MLLP wraps HL7 messages with special characters to mark the start and
          end:
        </p>
        <ul>
          <li>
            <strong>Start Block</strong>: <code>0x0B</code> (vertical tab
            character).
          </li>
          <li>
            <strong>End Block</strong>: <code>0x1C</code> (file separator)
            followed by <code>0x0D</code> (carriage return).
          </li>
        </ul>
        <p>
          Hermes handles this framing automatically. You work only with the HL7
          message content.
        </p>
      </section>

      <!-- Extensions -->
      <section id="extensions">
        <h2>Extensions</h2>
        <p>
          Extensions add third-party functionality to Hermes without modifying
          the core application. They are standalone programs that communicate
          with Hermes, allowing developers to create custom tools for specific
          workflows or organisation needs.
        </p>

        <div class="note">
          <strong>For Developers</strong>
          <p>
            If you want to create your own extension, see the API documentation
            in the <code>extensions/api-docs/</code> directory of the
            <a href="https://github.com/hamaluik/hermes">Hermes repository</a>.
          </p>
        </div>

        <h3 id="what-extensions-do">What Extensions Do</h3>
        <p>Extensions can provide several types of functionality:</p>
        <ul>
          <li>
            <strong>Toolbar buttons</strong>: Add custom buttons to the Hermes
            toolbar that trigger extension commands when clicked.
          </li>
          <li>
            <strong>Message operations</strong>: Read the current HL7 message,
            modify specific fields, or replace the entire message content.
          </li>
          <li>
            <strong>Web-based interfaces</strong>: Display interactive windows
            for complex workflows like patient lookup wizards, data entry forms,
            or search interfaces.
          </li>
          <li>
            <strong>Custom schemas</strong>: Provide organisation-specific field
            definitions, validation rules, and allowed values that supplement
            the built-in HL7 schema.
          </li>
        </ul>

        <h3 id="managing-extensions">Managing Extensions</h3>
        <p>
          Extensions are configured through the Settings modal. Open Settings by
          pressing <kbd>Cmd</kbd>+<kbd>,</kbd> or selecting
          <strong>File</strong> &rarr; <strong>Settings</strong>, then scroll to
          the <strong>Extensions</strong> section.
        </p>

        <h4>Adding an Extension</h4>
        <ol>
          <li>Click <strong>Add Extension</strong> in the Extensions section.</li>
          <li>Browse to select the extension executable file.</li>
          <li>
            The extension is added to the list and enabled by default.
          </li>
          <li>
            Click <strong>Reload Extensions</strong> to start the newly added
            extension.
          </li>
        </ol>

        <h4>Enabling and Disabling Extensions</h4>
        <p>
          Each extension has a toggle switch next to its name. Turn the switch
          off to disable an extension without removing it from your
          configuration. Disabled extensions remain in your settings but will
          not be started when you reload extensions.
        </p>

        <h4>Removing Extensions</h4>
        <p>
          Click the trash icon next to an extension to remove it from your
          configuration entirely. This does not delete the extension file from
          your computer.
        </p>

        <h4>Applying Changes</h4>
        <p>
          After adding, removing, or enabling/disabling extensions, click
          <strong>Reload Extensions</strong> to apply your changes. This
          restarts the extension system with the updated configuration.
        </p>

        <h4>Extension Status</h4>
        <p>
          Each extension shows a status indicator reflecting its current state:
        </p>
        <table>
          <thead>
            <tr>
              <th>Status</th>
              <th>Indicator</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Running</td>
              <td
                style="
                  background-color: var(--col-foam);
                  color: #000;
                  padding: 2px 6px;
                  border-radius: 3px;
                "
              >
                Green
              </td>
              <td>Extension is active and ready to use</td>
            </tr>
            <tr>
              <td>Failed</td>
              <td
                style="
                  background-color: var(--col-love);
                  color: #fff;
                  padding: 2px 6px;
                  border-radius: 3px;
                "
              >
                Red
              </td>
              <td>Extension crashed or failed to initialise</td>
            </tr>
            <tr>
              <td>Stopped</td>
              <td
                style="
                  background-color: var(--col-muted);
                  color: #fff;
                  padding: 2px 6px;
                  border-radius: 3px;
                "
              >
                Grey
              </td>
              <td>Extension is not running</td>
            </tr>
            <tr>
              <td>Starting</td>
              <td>—</td>
              <td>Extension is loading</td>
            </tr>
          </tbody>
        </table>

        <p>
          If an extension fails to start, an error message appears below its
          entry explaining what went wrong. Check the extension logs for more
          details.
        </p>

        <h3 id="extension-toolbar-buttons">Toolbar Buttons</h3>
        <p>
          Extensions can add custom buttons to the Hermes toolbar. These buttons
          appear at the right end of the toolbar, separated from the built-in
          buttons by a divider.
        </p>
        <ul>
          <li>
            <strong>Availability</strong>: Extension buttons are only enabled
            when their extension is in the Running state. If an extension stops
            or crashes, its buttons become disabled.
          </li>
          <li>
            <strong>Icons</strong>: Each button displays a custom icon provided
            by the extension, helping you identify its function at a glance.
          </li>
          <li>
            <strong>Usage</strong>: Click a button to trigger the corresponding
            extension command. The extension then performs its action, which may
            include modifying the message, opening a window, or other operations.
          </li>
        </ul>

        <h3 id="extension-windows">Extension Windows</h3>
        <p>
          Some extensions display web-based interfaces in separate windows. These
          windows allow for complex interactions like forms, search interfaces,
          or configuration dialogs.
        </p>

        <h4>Window Types</h4>
        <ul>
          <li>
            <strong>Modal windows</strong>: Appear above the main Hermes window
            and prevent interaction with Hermes until closed. Use these when the
            extension needs your full attention before proceeding.
          </li>
          <li>
            <strong>Non-modal windows</strong>: Open independently, allowing you
            to interact with both the extension window and Hermes simultaneously.
          </li>
        </ul>

        <h4>Closing Windows</h4>
        <p>
          Close extension windows using the standard window close button or by
          pressing <kbd>Cmd</kbd>+<kbd>W</kbd>. Some extensions may also provide
          their own close buttons within the interface.
        </p>

        <h3 id="extension-logs">Viewing Logs</h3>
        <p>
          Extensions can write log messages to help diagnose issues or provide
          status information. To view these logs:
        </p>
        <ol>
          <li>Open <strong>Settings</strong> (<kbd>Cmd</kbd>+<kbd>,</kbd>).</li>
          <li>Scroll to the <strong>Extensions</strong> section.</li>
          <li>Click <strong>View Logs</strong>.</li>
        </ol>
        <p>The Extension Logs modal shows:</p>
        <ul>
          <li>
            <strong>Timestamps</strong>: When each log entry was recorded.
          </li>
          <li>
            <strong>Log levels</strong>: Info (informational), Warn (warnings),
            or Error (problems).
          </li>
          <li>
            <strong>Messages</strong>: The actual log content from each extension.
          </li>
        </ul>
        <p>
          Use the filter dropdown to view logs from a specific extension or all
          extensions at once. Click <strong>Copy to Clipboard</strong> to copy
          the logs for sharing with extension developers when troubleshooting.
        </p>

        <div class="warning">
          <strong>Security</strong>
          <p>
            Extensions are trusted code that can read and modify your HL7
            messages. Only install extensions from sources you trust. Review an
            extension's documentation and source code before installing it.
          </p>
        </div>
      </section>

      <!-- Keyboard Shortcuts -->
      <section id="keyboard-shortcuts">
        <h2>Keyboard Shortcuts</h2>
        <p>
          Quick reference for all keyboard shortcuts in the application. You can
          also access this list at any time by pressing
          <kbd>Cmd</kbd>+<kbd>/</kbd> or selecting <strong>View</strong> &rarr;
          <strong>Keyboard Shortcuts</strong> from the menu.
        </p>

        <h3>File Operations</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>N</kbd></td>
              <td>New file</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>O</kbd></td>
              <td>Open file</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>S</kbd></td>
              <td>Save</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd></td>
              <td>Save As</td>
            </tr>
          </tbody>
        </table>

        <h3>Edit Operations</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Z</kbd></td>
              <td>Undo</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd></td>
              <td>Redo</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>X</kbd></td>
              <td>Cut</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>C</kbd></td>
              <td>Copy</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>V</kbd></td>
              <td>Paste</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>A</kbd></td>
              <td>Select All</td>
            </tr>
          </tbody>
        </table>

        <h3>Segment Operations</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>K</kbd></td>
              <td>Delete segment</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>↑</kbd></td>
              <td>Move segment up</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>↓</kbd></td>
              <td>Move segment down</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>D</kbd></td>
              <td>Duplicate segment</td>
            </tr>
          </tbody>
        </table>

        <h3>Find &amp; Replace</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>F</kbd></td>
              <td>Open Find</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>H</kbd></td>
              <td>Open Find &amp; Replace</td>
            </tr>
            <tr>
              <td><kbd>Enter</kbd></td>
              <td>Next match (in Find bar)</td>
            </tr>
            <tr>
              <td><kbd>Shift</kbd>+<kbd>Enter</kbd></td>
              <td>Previous match (in Find bar)</td>
            </tr>
            <tr>
              <td><kbd>Escape</kbd></td>
              <td>Close Find bar</td>
            </tr>
          </tbody>
        </table>

        <h3>Navigation</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>J</kbd></td>
              <td>Jump to Field</td>
            </tr>
            <tr>
              <td><kbd>Tab</kbd></td>
              <td>Next field (in message editor)</td>
            </tr>
            <tr>
              <td><kbd>Shift</kbd>+<kbd>Tab</kbd></td>
              <td>Previous field (in message editor)</td>
            </tr>
          </tbody>
        </table>

        <h3>View</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>=</kbd></td>
              <td>Zoom In</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>-</kbd></td>
              <td>Zoom Out</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>0</kbd></td>
              <td>Reset Zoom</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>/</kbd></td>
              <td>Keyboard Shortcuts</td>
            </tr>
          </tbody>
        </table>

        <h3>Tools</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>T</kbd></td>
              <td>Open Communication Drawer (Send tab)</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>L</kbd></td>
              <td>Open Communication Drawer (Listen tab)</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>D</kbd></td>
              <td>Compare Messages</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd></td>
              <td>Validate Message (Full)</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>G</kbd></td>
              <td>Generate Control ID</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd></td>
              <td>Insert Current Timestamp</td>
            </tr>
          </tbody>
        </table>

        <h3>Window</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>M</kbd></td>
              <td>Minimize window</td>
            </tr>
            <tr>
              <td><kbd>Cmd</kbd>+<kbd>W</kbd></td>
              <td>Close window</td>
            </tr>
          </tbody>
        </table>

        <h3>Message Editor</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>Tab</kbd></td>
              <td>Jump to next HL7 field</td>
            </tr>
            <tr>
              <td><kbd>Shift</kbd>+<kbd>Tab</kbd></td>
              <td>Jump to previous HL7 field</td>
            </tr>
            <tr>
              <td><kbd>Ctrl</kbd>+<kbd>Enter</kbd></td>
              <td>Open Communication Drawer (Send tab)</td>
            </tr>
          </tbody>
        </table>

        <h3>Help</h3>
        <table>
          <thead>
            <tr>
              <th>Shortcut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><kbd>F1</kbd></td>
              <td>Open Help window</td>
            </tr>
          </tbody>
        </table>

        <div class="note">
          <strong>Windows/Linux Users</strong>
          <p>Replace <kbd>Cmd</kbd> with <kbd>Ctrl</kbd> for all shortcuts.</p>
        </div>
      </section>

      <!-- Message Types Reference -->
      <section id="message-types">
        <h2>Message Types Reference</h2>
        <p>
          Hermes supports the following HL7 message types. Required segments are
          marked with an asterisk (*).
        </p>

        <h3>ADT - Admit/Discharge/Transfer</h3>
        <p>ADT messages communicate patient movement and demographic events.</p>
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
              <th>Segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ADT^A01</td>
              <td>Admit/visit notification</td>
              <td>MSH*, PID*, PV1*, EVN, NK1, DG1, NTE</td>
            </tr>
            <tr>
              <td>ADT^A02</td>
              <td>Transfer a patient</td>
              <td>MSH*, PID*, PV1*, EVN, NK1, DG1</td>
            </tr>
            <tr>
              <td>ADT^A03</td>
              <td>Discharge/end visit</td>
              <td>MSH*, PID*, PV1*, EVN, NK1, DG1</td>
            </tr>
            <tr>
              <td>ADT^A04</td>
              <td>Register a patient</td>
              <td>MSH*, PID*, EVN, PV1, NK1, DG1</td>
            </tr>
            <tr>
              <td>ADT^A05</td>
              <td>Pre-admit a patient</td>
              <td>MSH*, PID*, PV1*, EVN, NK1</td>
            </tr>
            <tr>
              <td>ADT^A08</td>
              <td>Update patient information</td>
              <td>MSH*, PID*, EVN, PV1, NK1, DG1</td>
            </tr>
            <tr>
              <td>ADT^A11</td>
              <td>Cancel admit</td>
              <td>MSH*, PID*, PV1*, EVN</td>
            </tr>
            <tr>
              <td>ADT^A12</td>
              <td>Cancel transfer</td>
              <td>MSH*, PID*, PV1*, EVN</td>
            </tr>
            <tr>
              <td>ADT^A13</td>
              <td>Cancel discharge</td>
              <td>MSH*, PID*, PV1*, EVN</td>
            </tr>
            <tr>
              <td>ADT^A23</td>
              <td>Delete patient record</td>
              <td>MSH*, PID*, EVN</td>
            </tr>
            <tr>
              <td>ADT^A34</td>
              <td>Merge patient information</td>
              <td>MSH*, PID*, EVN, PV1</td>
            </tr>
            <tr>
              <td>ADT^A40</td>
              <td>Merge patient identifier list</td>
              <td>MSH*, PID*, EVN, PV1</td>
            </tr>
            <tr>
              <td>ADT^A49</td>
              <td>Change patient identifier list</td>
              <td>MSH*, PID*, EVN</td>
            </tr>
            <tr>
              <td>ADT^A50</td>
              <td>Change visit number</td>
              <td>MSH*, PID*, PV1*, EVN</td>
            </tr>
          </tbody>
        </table>

        <h3>ORM - Order Message</h3>
        <p>
          ORM messages communicate orders for tests, procedures, or services.
        </p>
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
              <th>Segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ORM^O01</td>
              <td>Order message</td>
              <td>MSH*, PID*, PV1*, ORC*, EVN, OBR, DG1, NTE, OBX</td>
            </tr>
          </tbody>
        </table>

        <h3>ORU - Observation Result</h3>
        <p>ORU messages communicate test results and observations.</p>
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
              <th>Segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ORU^R01</td>
              <td>Observation result</td>
              <td>MSH*, PID*, OBR*, PV1, ORC, OBX, NTE</td>
            </tr>
          </tbody>
        </table>

        <h3>ORR - Order Response</h3>
        <p>ORR messages acknowledge or respond to orders.</p>
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
              <th>Segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ORR^O02</td>
              <td>Order response</td>
              <td>MSH*, PID*, ORC*, OBR</td>
            </tr>
          </tbody>
        </table>

        <h3>DFT - Detailed Financial Transaction</h3>
        <p>DFT messages communicate billing and charge information.</p>
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
              <th>Segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>DFT^P03</td>
              <td>Financial transaction</td>
              <td>MSH*, PID*, EVN, PV1, OBR</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Troubleshooting -->
      <section id="troubleshooting">
        <h2>Troubleshooting</h2>

        <h3>Parse Errors in the Editor</h3>
        <p>
          If the editor shows text in
          <span style="color: var(--col-love)">red</span>, there is a structural
          problem with your message.
        </p>
        <p>Common causes:</p>
        <ul>
          <li>
            <strong>Missing MSH segment</strong>: Every message must start with
            MSH.
          </li>
          <li>
            <strong>Incorrect MSH-1</strong>: The first field must be exactly
            <code>|</code>.
          </li>
          <li>
            <strong>Incorrect MSH-2</strong>: The encoding characters should be
            <code>^~\&amp;</code>.
          </li>
          <li>
            <strong>Line breaks in fields</strong>: Field values should not
            contain newlines.
          </li>
          <li>
            <strong>Missing segment identifier</strong>: Each line must start
            with a 3-letter segment ID.
          </li>
        </ul>

        <h3>Communication Errors</h3>
        <p>If you cannot send or receive messages:</p>
        <ul>
          <li>
            <strong>Connection refused</strong>: Check that the remote system is
            running and listening on the specified port.
          </li>
          <li>
            <strong>Timeout</strong>: The server may be slow to respond. Try
            increasing the timeout value in the Send tab.
          </li>
          <li>
            <strong>Host not found</strong>: Verify the hostname is correct and
            DNS is resolving properly.
          </li>
          <li>
            <strong>Port already in use</strong>: When starting the Listen
            server, another application may be using the port. Try a different
            port.
          </li>
          <li>
            <strong>Firewall blocking</strong>: Ensure your firewall allows
            connections on the MLLP port (typically 2575).
          </li>
        </ul>

        <h3>File Won't Open</h3>
        <ul>
          <li>
            <strong>Invalid format</strong>: The file may not contain a valid
            HL7 message. Check that it starts with "MSH".
          </li>
          <li>
            <strong>Encoding issues</strong>: The file should be UTF-8 or ASCII
            encoded. Other encodings may cause problems.
          </li>
          <li>
            <strong>Permissions</strong>: Ensure you have read access to the
            file.
          </li>
        </ul>

        <h3>Changes Not Syncing</h3>
        <p>
          If changes in the segment tabs are not appearing in the editor (or
          vice versa):
        </p>
        <ul>
          <li>
            Click outside the field you are editing to trigger the update.
          </li>
          <li>Check for parse errors that might prevent syncing.</li>
          <li>Try reloading the file.</li>
        </ul>

        <h3>Keyboard Shortcuts Not Working</h3>
        <ul>
          <li>Ensure the application window is focused.</li>
          <li>
            Some shortcuts only work in specific contexts (for example, Tab
            field navigation only works in the message editor).
          </li>
          <li>
            On Mac, check that you are using <kbd>Cmd</kbd> rather than
            <kbd>Ctrl</kbd>.
          </li>
        </ul>

        <h3>Extension Issues</h3>

        <h4>Extension Won't Start</h4>
        <ul>
          <li>
            Verify the executable path is correct and the file exists.
          </li>
          <li>
            Check that the file has execute permissions.
          </li>
          <li>
            View the extension logs for error messages.
          </li>
          <li>
            Ensure the extension responds within 10 seconds during
            initialisation; slow-starting extensions may time out.
          </li>
        </ul>

        <h4>Toolbar Buttons Not Appearing</h4>
        <ul>
          <li>
            Click <strong>Reload Extensions</strong> in Settings to restart the
            extension system.
          </li>
          <li>
            Check the extension status—buttons only appear when the extension is
            Running.
          </li>
          <li>
            If the extension shows as Failed, view the logs to diagnose the
            problem.
          </li>
        </ul>

        <h4>Extension Crashed</h4>
        <ul>
          <li>
            View the extension logs for error messages that may indicate what
            went wrong.
          </li>
          <li>
            Try clicking <strong>Reload Extensions</strong> to restart the
            extension.
          </li>
          <li>
            Contact the extension developer with the log output if the problem
            persists.
          </li>
        </ul>

        <div class="tip">
          <strong>Sharing Logs</strong>
          <p>
            When reporting extension issues to developers, use the
            <strong>Copy to Clipboard</strong> button in the Extension Logs
            modal to capture the relevant log entries.
          </p>
        </div>
      </section>
    </main>

    <script>
      // Highlight current section in navigation
      const sections = document.querySelectorAll("section[id]");
      const navLinks = document.querySelectorAll('nav a[href^="#"]');

      function updateActiveLink() {
        const scrollPos = window.scrollY + 100;

        sections.forEach((section) => {
          const top = section.offsetTop;
          const bottom = top + section.offsetHeight;
          const id = section.getAttribute("id");
          const link = document.querySelector(`nav a[href="#${id}"]`);

          if (link) {
            if (scrollPos >= top && scrollPos < bottom) {
              navLinks.forEach((l) => l.classList.remove("active"));
              link.classList.add("active");
            }
          }
        });
      }

      window.addEventListener("scroll", updateActiveLink);
      window.addEventListener("load", updateActiveLink);
    </script>

    <script>
      // open external links in OS default browser when running in Tauri
      function openExternalLink(e) {
        if (!window.__TAURI__) return;

        const link = e.target.closest("a[href]");
        if (!link) return;

        const href = link.getAttribute("href");
        if (href && (href.startsWith("http://") || href.startsWith("https://"))) {
          e.preventDefault();
          window.__TAURI__.core.invoke("open_url", { url: href });
        }
      }

      document.addEventListener("click", openExternalLink);
      document.addEventListener("auxclick", openExternalLink); // middle-click
      document.addEventListener("touchend", openExternalLink); // touch screens
    </script>

    <script>
      // find bar functionality
      const findBar = document.getElementById("find-bar");
      const findInput = document.getElementById("find-input");
      const matchCountEl = document.getElementById("match-count");
      const mainContent = document.querySelector("main");

      let matches = [];
      let currentMatchIndex = 0;

      // keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === "f") {
          e.preventDefault();
          openFindBar();
        }
        if (e.key === "Escape" && findBar.classList.contains("visible")) {
          e.preventDefault();
          closeFindBar();
        }
      });

      function openFindBar() {
        findBar.classList.add("visible");
        findInput.focus();
        findInput.select();
      }

      function closeFindBar() {
        findBar.classList.remove("visible");
        clearHighlights();
        matchCountEl.textContent = "";
      }

      function performSearch(query) {
        clearHighlights();
        matches = [];
        currentMatchIndex = 0;

        if (!query) {
          matchCountEl.textContent = "";
          return;
        }

        // walk text nodes in main content and wrap matches in <mark>
        const lowerQuery = query.toLowerCase();
        const walker = document.createTreeWalker(
          mainContent,
          NodeFilter.SHOW_TEXT,
          null
        );

        const textNodes = [];
        while (walker.nextNode()) {
          textNodes.push(walker.currentNode);
        }

        textNodes.forEach((node) => {
          const text = node.textContent;
          const lowerText = text.toLowerCase();
          let startIndex = 0;
          let index;

          while ((index = lowerText.indexOf(lowerQuery, startIndex)) !== -1) {
            // split the text node and wrap the match
            const before = text.substring(0, index);
            const match = text.substring(index, index + query.length);
            const after = text.substring(index + query.length);

            const mark = document.createElement("mark");
            mark.className = "find-highlight";
            mark.textContent = match;

            const parent = node.parentNode;
            const beforeNode = document.createTextNode(before);
            const afterNode = document.createTextNode(after);

            parent.insertBefore(beforeNode, node);
            parent.insertBefore(mark, node);
            parent.insertBefore(afterNode, node);
            parent.removeChild(node);

            matches.push(mark);

            // continue searching in the remaining text
            node = afterNode;
            startIndex = 0;
            break; // break to avoid issues with modified DOM; next iteration will catch more
          }
        });

        // re-run to catch all matches (simple approach for static content)
        if (matches.length > 0) {
          // second pass to find any remaining matches
          const walker2 = document.createTreeWalker(
            mainContent,
            NodeFilter.SHOW_TEXT,
            null
          );
          const moreTextNodes = [];
          while (walker2.nextNode()) {
            if (!walker2.currentNode.parentElement?.classList.contains("find-highlight")) {
              moreTextNodes.push(walker2.currentNode);
            }
          }
          moreTextNodes.forEach((node) => highlightInNode(node, lowerQuery, query.length));
        }

        // collect all marks
        matches = Array.from(mainContent.querySelectorAll("mark.find-highlight"));

        updateMatchDisplay();
        if (matches.length > 0) {
          scrollToCurrentMatch();
        }
      }

      function highlightInNode(node, lowerQuery, queryLength) {
        const text = node.textContent;
        const lowerText = text.toLowerCase();
        const index = lowerText.indexOf(lowerQuery);

        if (index === -1) return;

        const before = text.substring(0, index);
        const match = text.substring(index, index + queryLength);
        const after = text.substring(index + queryLength);

        const mark = document.createElement("mark");
        mark.className = "find-highlight";
        mark.textContent = match;

        const parent = node.parentNode;
        if (before) parent.insertBefore(document.createTextNode(before), node);
        parent.insertBefore(mark, node);
        if (after) parent.insertBefore(document.createTextNode(after), node);
        parent.removeChild(node);
      }

      function navigateMatch(direction) {
        if (matches.length === 0) return;

        // remove current highlight
        if (matches[currentMatchIndex]) {
          matches[currentMatchIndex].classList.remove("current");
        }

        currentMatchIndex =
          (currentMatchIndex + direction + matches.length) % matches.length;

        updateMatchDisplay();
        scrollToCurrentMatch();
      }

      function scrollToCurrentMatch() {
        if (matches[currentMatchIndex]) {
          matches[currentMatchIndex].classList.add("current");
          matches[currentMatchIndex].scrollIntoView({
            behavior: "smooth",
            block: "center",
          });
        }
      }

      function updateMatchDisplay() {
        if (matches.length === 0) {
          matchCountEl.textContent = "No matches";
        } else {
          matchCountEl.textContent = `${currentMatchIndex + 1} of ${matches.length}`;
        }
      }

      function clearHighlights() {
        const marks = mainContent.querySelectorAll("mark.find-highlight");
        marks.forEach((mark) => {
          const parent = mark.parentNode;
          const text = document.createTextNode(mark.textContent);
          parent.replaceChild(text, mark);
          // normalise adjacent text nodes
          parent.normalize();
        });
        matches = [];
        currentMatchIndex = 0;
      }

      // event listeners
      findInput.addEventListener("input", (e) => performSearch(e.target.value));
      findInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          navigateMatch(e.shiftKey ? -1 : 1);
        }
      });

      document.getElementById("find-prev").addEventListener("click", () => navigateMatch(-1));
      document.getElementById("find-next").addEventListener("click", () => navigateMatch(1));
      document.getElementById("find-close").addEventListener("click", closeFindBar);
    </script>
  </body>
</html>
